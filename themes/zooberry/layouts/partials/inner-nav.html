{{/*  Navigation that displays in the body of a page (If applicable).  */}}
{{/*  {{ if .Params.submenu }}
    <nav class="container inner-nav">
        <ul class="inner-nav-ul">
            {{ range .Params.submenu }}
                <li class="inner-nav-li">
                    <a href="{{ .url }}" class="inner-nav-a">{{ .name }}</a>
                </li>
            {{ end }}
        </ul>
    </nav>
{{ else }}  */}}
    <nav class="container inner-nav">
        <ul class="inner-nav-ul">
            <button id="menu-button" class="menu-button">
                <i class="material-icons">menu</i>
            </button>
            <a href="/" title="ZooBerry" class="nav-logo"></a>
            <div id="search-container" style="position: relative;">
                <input type="text" id="search-box" placeholder="Search mods...">
                <ul id="search-results"></ul>
            </div>
        </ul>
    </nav>
{{/*  {{ end }}  */}}

<script>
    let searchIndex;
  
    // get the JSON data
    fetch('/index.json')
      .then(response => response.json())
      .then(data => {
        console.log('Fetched JSON data:', data);
  
        // init Lunr.js
        searchIndex = lunr(function () {
          this.ref('url'); 
          this.field('title');
          this.field('mod_list_titles'); 
  
          data.forEach(doc => {
            console.log('Adding document to index:', doc);
  
            // combine all mod list titles into a single string
            const aggregatedTitles = doc.mod_list_titles.join(' ');
            this.add({
              title: doc.title.toLowerCase(),
              url: doc.url,
              mod_list_titles: aggregatedTitles.toLowerCase() // Ensure case-insensitive search
            });
          });
        });
  
        console.log('Lunr.js index initialized:', searchIndex);
  
        // store data in global variable for later retrieval
        window.searchDocs = data.reduce((acc, doc) => {
          acc[doc.url] = doc;
          return acc;
        }, {});
      })
      .catch(error => console.error('Error fetching or processing JSON:', error));
  
    // live search start
    document.getElementById('search-box').addEventListener('input', function () {
      const query = this.value.trim().toLowerCase();
      const resultsContainer = document.getElementById('search-results');
      resultsContainer.innerHTML = ''; // erase prev results
  
      if (query.length === 0 || !searchIndex) return;
  
      // wildcard to get partial matches
      const results = searchIndex.search(`${query}*`).slice(0, 10); // limit 10 results
      console.log('Search results:', results);
  
      results.forEach(result => {
        // get the matching document
        const doc = window.searchDocs[result.ref];
        console.log('Matching document:', doc);
  
        const link = document.createElement('a');
        link.href = doc.url;
        link.textContent = doc.title;
  
        const listItem = document.createElement('li');
        listItem.appendChild(link);
        resultsContainer.appendChild(listItem);
      });
    });
  </script>
  
  <style>
    #search-container {
        width: 100%;
      }

        #search-box {
            width: 80%;
            padding: 10px;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            outline: none;
        }
      
        #search-results {
            list-style-type: none;
            padding: 10px;
            margin: -3px 0 0;
            position: absolute; 
            top: 100%; 
            left: 0;
            width: 80%;
            background-color: #fff;
            border-radius: 0 0 5px 5px;
            z-index: 1000;
            max-height: 300px;
            overflow-y: auto; 
            display: block; 
          }
          
          #search-results li {
            margin: 5px 0;
            display: list-item; 
          }
          
          #search-results a {
            text-decoration: none;
            color: var(--thead-bg);
            display: block; 
            padding: 5px;
            background-color: transparent;
          }
          
          #search-results a:hover {
            background-color: #b6b6b6; 
          }
                              
  </style>