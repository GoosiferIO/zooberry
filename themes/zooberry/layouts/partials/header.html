{{ partial "menu.html" (dict "menuID" "main" "page" .) }}
<input type="text" id="search-box" placeholder="Search mods...">
<ul id="search-results"></ul>
<script>
    let searchIndex;
  
    // Fetch the JSON index
    fetch('/index.json')
      .then(response => response.json())
      .then(data => {
        console.log('Fetched JSON data:', data);
  
        // Initialize Lunr.js
        searchIndex = lunr(function () {
          this.ref('url');
          this.field('title');
  
          data.forEach(doc => {
            console.log('Adding document to index:', doc);
            this.add({
              title: doc.title.toLowerCase(), // Lowercase for case-insensitive search
              url: doc.url
            });
          });
        });
  
        console.log('Lunr.js index initialized:', searchIndex);
  
        // Store the data for lookup
        window.searchDocs = data.reduce((acc, doc) => {
          acc[doc.url] = doc;
          return acc;
        }, {});
      })
      .catch(error => console.error('Error fetching or processing JSON:', error));
  
    document.getElementById('search-box').addEventListener('input', function () {
      const query = this.value.trim().toLowerCase();
      const resultsContainer = document.getElementById('search-results');
      resultsContainer.innerHTML = ''; // Clear previous results
  
      if (query.length === 0 || !searchIndex) return;
  
      // get wildcard results
      const results = searchIndex.search(`${query}*`).slice(0, 10);
      console.log('Search results:', results);
  
      results.forEach(result => {
        // get the matching document
        const doc = window.searchDocs[result.ref]; 
        console.log('Matching document:', doc);
  
        const link = document.createElement('a');
        link.href = doc.url;
        link.textContent = doc.title;
  
        const listItem = document.createElement('li');
        listItem.appendChild(link);
        resultsContainer.appendChild(listItem);
      });
    });
  </script>
  
    
  <style>
    #search-results {
        list-style-type: none;
        padding: 0;
      }
      
      #search-results li {
        margin: 5px 0;
      }
      
      #search-results a {
        text-decoration: none;
        color: #fff;
      }
      
      #search-results a:hover {
        text-decoration: underline;
      }
  </style>