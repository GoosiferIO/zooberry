{{ partial "menu.html" (dict "menuID" "main" "page" .) }}
<input type="text" id="search-box" placeholder="Search mods...">
<ul id="search-results"></ul>
<script>
    let searchIndex;
  
    // get the JSON data
    fetch('/index.json')
      .then(response => response.json())
      .then(data => {
        console.log('Fetched JSON data:', data);
  
        // init Lunr.js
        searchIndex = lunr(function () {
          this.ref('url'); // Use 'url' as the unique identifier
          this.field('title'); // Include page title
          this.field('mod_list_titles'); // Include mod_list_titles
  
          data.forEach(doc => {
            console.log('Adding document to index:', doc);
  
            // combine titles and mod_list_titles for full-text search
            const aggregatedTitles = doc.mod_list_titles.join(' ');
            this.add({
              title: doc.title.toLowerCase(),
              url: doc.url,
              mod_list_titles: aggregatedTitles.toLowerCase() // Ensure case-insensitive search
            });
          });
        });
  
        console.log('Lunr.js index initialized:', searchIndex);
  
        // store the data for lookup
        window.searchDocs = data.reduce((acc, doc) => {
          acc[doc.url] = doc;
          return acc;
        }, {});
      })
      .catch(error => console.error('Error fetching or processing JSON:', error));
  
    // perform live search
    document.getElementById('search-box').addEventListener('input', function () {
      const query = this.value.trim().toLowerCase();
      const resultsContainer = document.getElementById('search-results');
      resultsContainer.innerHTML = ''; // rmv prev results
  
      if (query.length === 0 || !searchIndex) return;
  
      // wildcard so that it matches partial words
      const results = searchIndex.search(`${query}*`).slice(0, 10); // limit 10 results
      console.log('Search results:', results);
  
      results.forEach(result => {
        // get correct document from the data store
        const doc = window.searchDocs[result.ref];
        console.log('Matching document:', doc);
  
        const link = document.createElement('a');
        link.href = doc.url;
        link.textContent = doc.title;
  
        const listItem = document.createElement('li');
        listItem.appendChild(link);
        resultsContainer.appendChild(listItem);
      });
    });
  </script>
  
  
    
  <style>
    #search-results {
        list-style-type: none;
        padding: 0;
      }
      
      #search-results li {
        margin: 5px 0;
      }
      
      #search-results a {
        text-decoration: none;
        color: #fff;
      }
      
      #search-results a:hover {
        text-decoration: underline;
      }
  </style>